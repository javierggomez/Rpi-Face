#!/bin/bash

#    Copyright (C) 2013 Javier García, Julio Alberto González

#    This file is part of Rpi-Face.
#    Rpi-Face is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.

#    Rpi-Face is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.

#    You should have received a copy of the GNU General Public License
#    along with Rpi-Face.  If not, see <http://www.gnu.org/licenses/>.


#echo "calculando nota<br>"

# Direccion raiz de los binarios de ACOPOST
DIR_ACO_BIN=./acopost/acopost-1.8.6/bin

T3=$DIR_ACO_BIN/t3

#Definición de variables.
sum=0
t=1

#Fichero en los que se encuentran los trigramas.
NGRAM_EMO="acopost/FINALEMO.123"

#Fichero en el que se encuentra el diccionario con las notas correspondientes a cada palabra.
LEX_EMO="acopost/FINALEMO.lex"
#LEX_EMO="alternative.lex"

#Llamada al programa T3 de la libreria ACOPOST que realiza el etiquetado.
$T3 $NGRAM_EMO $LEX_EMO < $1 > analysis.t3
 

#Dado que los resultados se muestran a modo de una nota por palabra, este comando lo que hace es calcular la media de lo que hay en la segunda columna de texto de el archivo que te devuelve el etiquetador, es decir, la media de la nota de las palabras.  
average=`awk '{if(NR>4) {sum+=$2; ++t}} END { print sum/t}'  analysis.t3` 
echo $average
./move_face $average
