#!/bin/bash
#echo "calculando nota<br>"

# Direccion raiz de los binarios de ACOPOST
DIR_ACO_BIN=../acopost/acopost-1.8.6/bin

T3=$DIR_ACO_BIN/t3

#Definici√≥n de variables.
sum=0
t=1
#Identificador de usuario pasado como parametro.
MESSAGEID=$1

#Fichero en los que se encuentran los trigramas.
NGRAM_EMO="FINALEMO.123"

#Fichero en el que se encuentra el diccionario con las notas correspondientes a cada palabra.
LEX_EMO="FINALEMO.lex"


#Llamada al programa T3 de la libreria ACOPOST que realiza el etiquetado.
$T3 $NGRAM_EMO $LEX_EMO < test2.$MESSAGEID.raw > comentario.$MESSAGEID.t3

#Borramos este archivo ya que tras ser usado por el programa t3 no nos es de utilidad.    
rm test2.$MESSAGEID.raw   

#Dado que los resultados se muestran a modo de una nota por palabra, este comando lo que hace es calcular la media de lo que hay en la segunda columna de texto de el archivo que te devuelve el etiquetador, es decir, la media de la nota de las palabras.  
awk '{if(NR>4) {sum+=$2; ++t}} END { print sum/t}'  comentario.$MESSAGEID.t3 > media.$MESSAGEID.m

#Borramos el archivo que te devuelve el etiquetador ya que una vez calculada la media es innecesario.
rm comentario.$MESSAGEID.t3
